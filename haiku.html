<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>haiku</title>
  <style>
    h2 {
	  font-family: Helvetica, sans-serif;
	  font-weight: 100;
    }
  </style>
</head>
<body>

<h2 class="haiku">
</h2>

<!--
<div class="haiku two">
</div>
-->

<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script type="text/javascript">

var haiku = [
  [["I"], ["re","i","ma","gine"]],
  [["us","er"], ["ex", "pe", "ri", "en", "ces"]],
  [["with"], ["de","sign"], ["and"], ["code."]]
];

var line = d3.selectAll(".haiku")
    .selectAll(".line")
      .data(haiku)   
      .enter().append("div")
      .attr("class", "line")
      .attr("data-index", function (d, i) { return i; })
      .style("margin-bottom", "15px");
      
var word = line.selectAll(".word")
      .data(function(d, i) { return d; })
      .enter().append("span")
      .attr("class", "word")
      .style("padding", "5px");

var sylIndex = 0;      
var syllable = word.selectAll(".syllable")
      .data(function(d, i) { return d; })
      .enter().append("span")
      .attr("class", "syllable")
      .text(function(d,i) { 
        return d;
      })
      .style("margin-right", "4px")
      .style("border-bottom", "1px solid #CCC")
      .insert("span")
        .attr("class", "syl-index")
        .style("position", "relative")
        .style("top", "14px")
        .style("font-size", "7px")
        .text(function(d, i, j) {
          var line = ((this.parentNode).parentNode).parentNode;
          var lineIndex = parseInt(line.getAttribute("data-index"));
          
          sylIndex++;
          
          switch(lineIndex) {
	        case 0:
	          return sylIndex;
	        case 1:
	          return sylIndex-5;
	        
	        case 2:
	          return sylIndex-12;
	          
	        default:
	          return sylIndex;
          }
          
        });
  
</script>
 
</body>
</html>