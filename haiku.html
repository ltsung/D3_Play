<!--
A simple haiku visualizer.

Author: Lauren Tsung
-->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Haiku Visualized</title>
  <style>
    h2 {
	  font-family: Helvetica, sans-serif;
	  font-weight: 100;
    }
    
    .hidden {
	  display: none;
    }
  </style>
</head>
<body>

<h2 class="haiku">
</h2>

<h2 class="haiku">
</h2>

<h2 class="haiku ">
</h2>

<h2 class="haiku">
</h2>

<h2 class="haiku">
</h2>

<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script type="text/javascript">

var haiku = [
  [["I"], ["re","i","ma","gine"]],
  [["us","er"], ["ex", "pe", "ri", "en", "ces"]],
  [["with"], ["de","sign"], ["and"], ["code."]]
];

var line = d3.selectAll(".haiku")
  .selectAll(".line")
    .data(haiku)   
    .enter().append("div")
    .attr("class", "line")
    .attr("data-index", function (d, i) { return i; })
    .style("margin-bottom", "15px");
  
var word = line.selectAll(".word")
  .data(function(d, i) { return d; })
  .enter().append("span")
  .attr("class", "word")
  .style("padding", "3px");

var sylIndex = 0;
var lastLineLength = 0;      
var syllable = word.selectAll(".syllable")
  .data(function(d, i) { return d; })
  .enter().append("span")
  .attr("class", "syllable")
  .text(function(d,i) { 
    return d;
  })
  .insert("span")
    .attr("class", "syl-index hidden")
    .text(function(d, i, j) {
      var line = ((this.parentNode).parentNode).parentNode;
      var lineIndex = parseInt(line.getAttribute("data-index"));
      ++sylIndex;
      
      switch(lineIndex) {
        case 0:
          return sylIndex;
        case 1:
          return sylIndex-5; 
        case 2:
          ++lastLineLength;
          var indexValue = sylIndex-12;
          if (lastLineLength > haiku[2].length) {
            sylIndex = 0;
            lastLineLength = 0;	          
          }
          return indexValue;
        default:
          return sylIndex;
      }
    });

var word = d3.selectAll(".haiku .line .word");
var syllable = d3.selectAll(".haiku .line .word .syllable");
var sylIndex = d3.selectAll(".haiku .line .word .syl-index");

d3.selectAll(".haiku")
  .on("mouseover", function() {
    syllable.transition().ease("linear")
      .duration(100)
      .style("margin-right", "4px")
      .style("border-bottom", "1px solid #CCC");
         
    sylIndex.attr("class", "syl-index")
      .style("position", "relative")
      .style("top", "16px")
      .style("left", function(d) {
        var width = (this.parentNode).offsetWidth;
        width /= 2;
        width *= -1;
        return width + "px";  
      })
      .style("font-size", "7px");
  })
  .on("mouseout", function() {
    sylIndex.attr("class", "syl-index hidden")
      .style("position", "relative")
      .style("top", "0")
      .style("left", "0")
      .style("font-size", "7px");
    
    syllable.transition().ease("linear")
      .duration(300)
      .style("margin-right", "0px")
      .style("border-bottom", "none");
  });
</script>
 
</body>
</html>